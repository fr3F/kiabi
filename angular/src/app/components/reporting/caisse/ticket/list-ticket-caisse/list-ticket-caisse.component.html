<div class="card">
    <div class="card-body">
        <h4>Tickets {{magasin}}, caisse n° {{caisse.nocaisse}} du {{debut | date: 'dd-MM-yyyy'}} <span *ngIf="fin!=debut">au {{fin | date: 'dd-MM-yyyy'}}</span></h4>
        <div class="search-box me-2 mb-2">
            <div class="position-relative">
            <input
                type="text"
                class="form-control"
                placeholder="Rechercher par numéro ou client"
                [(ngModel)]="motSearch"
                (ngModelChange)="search()"
            />
            <i
                class="bx bx-search-alt search-icon"
                type="button"
                (click)="search()"
            ></i>
            </div>
        </div>


        <!-- end col-->
        <div class="col-sm-12 col-md-5 mt-2">
            <div class="dataTables_info mb-2" id="tickets-table_info" role="status" aria-live="polite">
                {{ list.length }} tickets trouvés
            </div>
        </div>

        <div class="col-12 text-right">
            <button class="btn btn-sm btn-warning" (click)="chargerListMagasin()">
                Charger tous vers magasin
                <i class="fa fa-sync"></i>
            </button>
        </div>

        <div class="table-responsive">
            <p class="text-center" style="margin: 30px 0px;" *ngIf="!list.length">Aucun ticket trouvé</p>
            <table class="table table-sm table-bordered table-nowrap" *ngIf="list.length">
                <thead class="table-dark">
                    <tr>
                        <th>N° ticket</th>
                        <th>Date</th>
                        <th>Dépôt</th>
                        <th>Montant HT</th>
                        <th>Montant TTC</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let item of list">
                        <td>{{item.numticket}}</td>
                        <td>{{item.datecreation | date: 'dd-MM-yyyy HH:mm'}}</td>
                        <td>{{item.depot}}</td>
                        <td class="text-right">{{item.montantht | appcurrency}}</td>
                        <td class="text-right">{{item.montanttotal | appcurrency}}</td>
                        <td  class="text-center">
                            <button class="btn btn-sm btn-info me-2"
                                (click)="openDetail(modal, item)"
                                ngbTooltip="Voir détail"
                            >
                                <i class="fa fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-warning me-2" (click)="chargerMagasin(item)"
                                ngbTooltip="Charger vers magasin" *ngIf="!item.ticketMagasin"
                            >
                                <i class="fa fa-sync"></i>
                            </button>
                            <button class="btn btn-sm btn-primary me-2" (click)="regulariserVenteDepot(item)"
                                ngbTooltip="Régulariser facture vente depot" *ngIf="acces.regulVenteDepot && showRegulVenteDepot(item)"
                            >
                                <i class="fa fa-cog"></i>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>




<ng-template #modal role="document" let-modal>
    <div class="modal-header">
        <h5 class="modal-title mt-0">Détail ticket</h5>
        <button type="button" class="btn-close" aria-hidden="true" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">
        <app-details-ticket [id]="selectedTicket.idticket" [idCaisse]="caisse.id"></app-details-ticket>
    </div>
</ng-template>
