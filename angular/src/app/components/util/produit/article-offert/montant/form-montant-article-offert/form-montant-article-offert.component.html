<form [formGroup]="formGroup" (ngSubmit)="validate()">
    <div class="mt-2 col-6">
        <label>Magasin</label>
        <select class="form-control form-control-sm" [(ngModel)]="data.magasin" *ngIf="magasins" formControlName="data.magasin"
            [ngClass]="{'is-invalid': isInvalid('magasin')}" (change)="verifyArticles()"
        >
            <option *ngFor="let item of magasins" [value]="item.nommagasin">{{item.nommagasin}}</option>
        </select>
        <div class="invalid-feedback" *ngIf="isInvalid('magasin')">
            Veuillez séléctionner un magasin
        </div>
    </div>  

    

    <div class="mt-2 row" style="padding: 0;">
        <div class="col-6">
            <label>Début</label>
            <input type="datetime-local" class="form-control form-control-sm" [(ngModel)]="data.debut" formControlName="data.debut"
                [ngClass]="{'is-invalid': isInvalid('debut')}"  (change)="verifyArticles()"
            >
            <div class="invalid-feedback" *ngIf="isInvalid('debut')">
                Veuillez renseigne la date de début
            </div>
        </div>
        <div class="col-6">
            <label>Fin</label>
            <input type="datetime-local" class="form-control form-control-sm" [(ngModel)]="data.fin" formControlName="data.fin"
                [ngClass]="{'is-invalid': isInvalid('fin') || finInvalid()}" (change)="verifyArticles()"
            >
            <div class="invalid-feedback" *ngIf="isInvalid('fin') || finInvalid()">
                <span *ngIf="isInvalid('fin')">Veuillez renseigne la date de fin</span>
                <span *ngIf="finInvalid()">Veuillez renseigne une date fin après la date début</span>
            </div>
        </div>
    </div>  

    <div class="col-6 mt-1">
        <label>Règle</label>
        <select class="form-control form-control-sm" [(ngModel)]="data.regle" formControlName="data.regle"
            [ngClass]="{'is-invalid': isInvalid('regle')}"
        >
            <option value="1">Entre</option>
            <option value="2">Plus de</option>
        </select>
        <div class="invalid-feedback" *ngIf="isInvalid('regle')">
            Veuillez séléctionner le règle
        </div>
    </div>

    <div class="mt-2 row" style="padding: 0;">
        <div class="col-6">
            <label>Montant minimum</label>
            <input type="number" class="form-control form-control-sm" [(ngModel)]="data.montantmin" formControlName="data.montantmin"
                [ngClass]="{'is-invalid': isInvalid('montantmin')}" 
            >
            <div class="invalid-feedback" *ngIf="isInvalid('montantmin')">
                Veuillez renseigne le montant minimum
            </div>
        </div>
        <div class="col-6" *ngIf="data.regle == '1'">
            <label>Montant maximum</label>
            <input type="number" class="form-control form-control-sm" [(ngModel)]="data.montantmax" formControlName="data.montantmax"
                [ngClass]="{'is-invalid': isInvalid('montantmax') || montantMaxInvalid()}" 
            >
            <div class="invalid-feedback" *ngIf="isInvalid('montantmax') || montantMaxInvalid()">
                Veuillez renseigne un montant maximum superieur au montant minimum
            </div>        
        </div>
    </div>  

    <div class="mt-3">
        <h5>Articles
            <button class="btn btn-sm btn-primary" type="button" style="margin-left: 20px;"
                (click)="showAddArticle(modal)" *ngIf="canAdd()"
            >
                Ajouter
            </button>
        </h5>
        <app-offered-articles-list [articles]="data.articles"></app-offered-articles-list>    
    </div>
    
    <div class="mt-2 text-center">
        <button class="btn btn-success" type="submit">Enregistrer</button>
    </div>
</form>



<ngx-spinner type="ball-scale-multiple" [fullScreen]="true">
    <p style="color: white; text-align: center;">Veuillez patienter s'il vous plaît...</p> 
</ngx-spinner>



<ng-template #modal role="document" let-modal>
    <div class="modal-header">
        <h5 class="modal-title mt-0">Ajouter un article</h5>
        <button type="button" class="btn-close" aria-hidden="true" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">
        <app-add-offered-article (onValidate)="onArticleAdded($event)"
        >
        </app-add-offered-article>
    </div>
</ng-template>
